!function(e){function o(a){if(r[a])return r[a].exports;var u=r[a]={exports:{},id:a,loaded:!1};return e[a].call(u.exports,u,u.exports,o),u.loaded=!0,u.exports}var r={};return o.m=e,o.c=r,o.p="",o(0)}([function(e,o,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function u(e,o){var r=e.data.name;I.indexOf(r)>=0?(I.splice(I.indexOf(r),1),d3.select(this).attr("fill",M.heat[r])):(I.push(r),d3.select(this).attr("fill","#A7A8AA")),W.selectAll("*").remove();for(var a=0;a<f.AppData.length;a++)S(a)}function t(){L=document.getElementById("percentileCheck").checked,d3.select(".Chartcontainer").selectAll("*").remove(),H=v.getWidth(),y(f.AppData[0].Data[0].groupByVarName)}function p(){var e=h(),o=R.append("div").attr("class","dropdown");console.log(O),o.append("button").attr("class","dropbtn").html("<b>Group By:</b> "+v.shortenString(O)).append("span").style("float","right").html(" ▼");var r=o.append("div").attr("class","dropdown-content");r.selectAll("a").data(e).enter().append("a").html(function(e){return e}).attr("onclick",function(e){return"intializeTreeMap('"+e+"')"});R.append("div").attr("class","perc-check").html("<input id='percentileCheck' class='perc-checkinput' checked='true' onchange='togglePercentile()' type='checkbox'><label for='percentileCheck'>Percentiles</label>")}function l(e,o){setTimeout(function(){E=!0},300);var r=G.statData.filter(function(o){return o.groupByVarName==O&&o.groupByValue==e.data.name})[0],a=G.proportion.filter(function(o){return o.name==e.data.name})[0];b.style("opacity",1).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px").style("color",M.heat[e]).html("Group <b>"+r.groupByValue+" </b> is "+a.perc+"% of the data and has an average error of <b>"+v.formatLabel(r[G.ErrType])+"</b>")}function i(e,o){setTimeout(function(){E=!0},300);var r=G.statData.filter(function(o){return o.groupByVarName==O&&o.groupByValue==e.data.name})[0],a=G.proportion.filter(function(o){return o.name==e.data.name})[0];b.style("opacity",1).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px").style("color",M.heat[e.data.name]).html("Group <b>"+r.groupByValue+" </b> is "+v.formatLabel(a.perc)+"% of the data and has an average error of <b>"+v.formatLabel(r[G.ErrType])+"</b>")}function d(e,o){b.style("opacity",0)}function y(e){function o(e){return e.children?0:1}function r(e){return e.size}O=e,s(),d3.select(".dropbtn").html("<b>Group By:</b> "+v.shortenString(O)).append("span").style("float","right").html(" ▼");var a=c(O),t={top:50,right:15,bottom:30,left:60};A.selectAll("*").remove();var p=.8*v.getWidth()-.1*t.left-t.right-.1*v.getWidth(),y=200-t.top-t.bottom;A.attr("width",p),A.attr("height",y);var h=function(e){return d3.interpolateRgb(e,"#fff")(.2)},m=(d3.scaleOrdinal(d3.schemeCategory20.map(h)),d3.format(",d"),d3.treemap().tile(d3.treemapResquarify).size([p,y-20]).round(!0).paddingInner(2)),g=d3.hierarchy(a).eachBefore(function(e){e.data.id=(e.parent?e.parent.data.id+".":"")+e.data.name}).sum(r).sort(function(e,o){return o.data.name-e.data.name});G.proportion=g.data.children;var V=0;for(var B in G.proportion)V+=G.proportion[B].size;for(var B in G.proportion)G.proportion[B].perc=100*G.proportion[B].size/V;m(g);var n=A.append("g").attr("class","cell-group").attr("transform","translate(0,0)"),N=n.selectAll("g").data(g.leaves()).enter().append("g").attr("transform",function(e){return"translate("+e.x0+","+e.y0+")"});N.append("rect").attr("id",function(e){return e.data.id+" brdr"}).attr("x",-2).attr("y",-2).attr("class","borderpath").attr("width",function(e){return e.x1-e.x0+4}).attr("height",function(e){return e.y1-e.y0+4}).attr("fill",function(e){return"#53565A"}).style("cursor","pointer"),N.append("rect").attr("id",function(e){return e.data.id}).attr("class","rect").attr("width",function(e){return e.x1-e.x0}).attr("height",function(e){return e.y1-e.y0}).attr("fill",function(e){return M.heat[e.data.name]}).on("click",u).on("mouseenter",l).on("mouseout",d).on("mousemove",i).style("cursor","pointer"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",20).text(function(e){if(e.x1-e.x0>100){var o=G.statData.filter(function(o){return o.groupByVarName==O&&o.groupByValue==e.data.name})[0],r=G.proportion.filter(function(o){return o.name==e.data.name})[0];return"Category: "+o.groupByValue+" ("+v.formatLabel(r.perc)+"%)"}return""}).style("fill","#fff"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",40).text(function(e){if(e.x1-e.x0>100){var o=G.statData.filter(function(o){return o.groupByVarName==O&&o.groupByValue==e.data.name})[0];return"Average Error: "+v.formatLabel(o[G.ErrType])}return""}).style("fill","#fff"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",60).text(function(e){if(e.x1-e.x0>100){G.statData.filter(function(o){return o.groupByVarName==O&&o.groupByValue==e.data.name})[0];return"Error Type: "+G.ErrType}return""}).style("fill","#fff"),d3.selectAll("input").data([r,o],function(e){return e?e.name:this.value}),W.selectAll("*").remove();for(var Y=0;Y<f.AppData.length;Y++)S(Y)}function c(e){var o={name:"heatMap",children:[]},r=f.AppData[0].Data,a=r.filter(function(o){return o.groupByVarName==e}),u=G.statData.filter(function(o){return o.groupByVarName==e});console.log(a);var t=d3.nest().key(function(e){return e.groupByValue}).rollup(function(e){return e.length}).entries(u);return t.forEach(function(e){var r={};r.name=e.key,r.size=u.filter(function(o){return o.groupByValue==e.key})[0].Total,o.children.push(r)}),o.children=o.children.sort(v.sortDictionary),o}function h(){var e=[];return f.AppData.forEach(function(o){o.Data.forEach(function(o){e.indexOf(o.groupByVarName)<0&&e.push(o.groupByVarName)})}),e}function m(e,o,r,a){var u=G.percData.filter(function(e){return e.variable==a})[0],t=u.percentileList.filter(function(e){return e.groupByVar==r})[0],p=t.percentileValues.filter(function(e){return e.percentiles==o+"%"})[0];return p.value}function g(e,o,r,a){var u=G.percGData.filter(function(e){return e.variable==a&e.percentile==o+"%"})[0];return u.value}function V(e,o,r){if(0==r.length)return 0;var a=d3.extent(e.map(function(e){return e[o]})),u={},t={};t.overEst="",t.underEst="",u.quartiles=[];for(var p=(d3.quantile(a,.25)-d3.min(a),1);p<=4;p++)for(var l in r){var i=r[l],d={};d.quarter=p,d.group=i;var y=m(e,25*(p-1),i,o),c=m(e,25*p,i,o);d.range=[y,c];var h=e.filter(function(e){return e[o]>=y&&e[o]<=c&&e.groupByValue==i});d.averageImpact=d3.mean(h.map(function(e){return e.predictedYSmooth})),d.medianImpact=d3.median(h.map(function(e){return e.predictedYSmooth})),d.estimate=Math.abs(d3.mean(h.map(function(e){return e.predictedYSmooth}))/d3.mean(h.map(function(e){return e.predictedYSmooth}))),d.estimate>=1?t.overEst+=v.formatLabel(y)+"-"+v.formatLabel(c)+", ":t.underEst+=v.formatLabel(y)+"-"+v.formatLabel(c)+", ",u.quartiles.push(d)}return t.lowest=d3.min(u.quartiles.map(function(e){return e.averageImpact})),t.highest=d3.max(u.quartiles.map(function(e){return e.averageImpact})),t.lowestGroup=u.quartiles.filter(function(e){return e.averageImpact==t.lowest})[0].group,t.lowestGroup=t.lowestGroup.indexOf("Bin")>=0?"for group "+t.lowestGroup.split("_")[1]:" for "+t.lowestGroup,t.highestGroup=u.quartiles.filter(function(e){return e.averageImpact==t.highest})[0].group,t.highestGroup=t.highestGroup.indexOf("Bin")>=0?"for group "+t.highestGroup.split("_")[1]:" for "+t.highestGroup,t.lowestQuartile=u.quartiles.filter(function(e){return e.averageImpact==t.lowest})[0].range,t.highestQuartile=u.quartiles.filter(function(e){return e.averageImpact==t.highest})[0].range,t.lowestRange=t.lowestQuartile,t.highestRange=t.highestQuartile,t.overAllAverageImpact=d3.mean(e.map(function(e){return e.predictedYSmooth})),t.overAllMedianImpact=d3.median(e.map(function(e){return e.predictedYSmooth})),t.diffMaxOverall=t.highest-t.overAllMedianImpact,t.diffMaxMin=t.highest-t.lowest,t}function B(e,o,r,a){var u=d3.extent(e.map(function(e){return e[o]})),t={},p={};p.overEst="",p.underEst="",t.quartiles=[];var l=d3.quantile(u,.25)-d3.min(u);for(var i in a)for(var d in r){var y=a[i],c=r[d],h={};h.quarter=y,h.group=c;var m=e.filter(function(e){return e[o]==y&&e.groupByValue==c});h.averageImpact=d3.mean(m.map(function(e){return e.predictedYSmooth})),h.medianImpact=d3.median(m.map(function(e){return e.predictedYSmooth})),h.estimate=Math.abs(d3.mean(m.map(function(e){return e.predictedYSmooth}))/d3.mean(m.map(function(e){return e.predictedYSmooth}))),h.estimate>=1?p.overEst+=y+", ":p.underEst+=y+", ",t.quartiles.push(h)}return p.lowest=d3.min(t.quartiles.map(function(e){return e.averageImpact})),p.highest=d3.max(t.quartiles.map(function(e){return e.averageImpact})),p.lowestGroup=t.quartiles.filter(function(e){return e.averageImpact==p.lowest})[0].group,p.lowestGroup=p.lowestGroup.indexOf("Bin")>=0?"for group "+p.lowestGroup.split("_")[1]:" for "+p.lowestGroup,p.highestGroup=t.quartiles.filter(function(e){return e.averageImpact==p.highest})[0].group,p.highestGroup=p.highestGroup.indexOf("Bin")>=0?"for group "+p.highestGroup.split("_")[1]:" for "+p.highestGroup,p.lowestQuartile=t.quartiles.filter(function(e){return e.averageImpact==p.lowest})[0].quarter,p.highestQuartile=t.quartiles.filter(function(e){return e.averageImpact==p.highest})[0].quarter,p.lowestRange=[v.formatLabel(d3.min(u)+l*(p.lowestQuartile-1)),v.formatLabel(d3.min(u)+l*p.lowestQuartile)],p.highestRange=[v.formatLabel(d3.min(u)+l*(p.highestQuartile-1)),v.formatLabel(d3.min(u)+l*p.highestQuartile)],p.overAllAverageImpact=d3.mean(e.map(function(e){return e.predictedYSmooth})),p.overAllMedianImpact=d3.median(e.map(function(e){return e.predictedYSmooth})),p.diffMaxOverall=p.highest-p.overAllMedianImpact,p.diffMaxMin=p.highest-p.lowest,p}function s(){for(var e=[],o=0;o<f.AppData.length;o++){var r=f.AppData[o].Data.filter(function(e){return e.groupByVarName==O});if(r.length>0){var a=r[0],u=Object.keys(a).filter(function(e){return D.indexOf(e)<0})[0];M[u]={},M.heat={},r.forEach(function(o){e.indexOf(o.groupByValue)<0&&e.push(o.groupByValue)}),e.sort(v.sortAlphaNum),e.forEach(function(e,o){M[u][e]=C[o]})}}e.forEach(function(e,o){M.heat[e]=C[o]})}function n(){f.AppData.filter(function(e,o){"Accuracy"==e.Type&&(G.statData=e.Data,G.ErrType=e.ErrType,G.yVar=e.Yvar,f.AppData.splice(o,1))}),f.AppData.filter(function(e,o){"PercentileGroup"==e.Type&&(G.percData=e.Data,f.AppData.splice(o,1))}),f.AppData.filter(function(e,o){"Percentile"==e.Type&&(G.percGData=e.Data,f.AppData.splice(o,1))})}function S(e){function o(){function o(a){function i(o,r){d3.selectAll(".layer"+e).style("opacity",.25),d3.selectAll(".path"+o+e).style("opacity",1).attr("stroke-width","3px")}function y(o,r){d3.selectAll(".layer"+e).style("opacity",1).attr("stroke-width","2px")}function h(e,r){N[t].indexOf(e)>=0?(N[t].splice(N[t].indexOf(e),1),o(!1),d3.select(this).style("opacity",.5).style("background-color","#A7A8AA")):(N[t].push(e),o(!1),d3.select(this).style("opacity",1).style("background-color",M[t][e]))}function f(e){var o=r();b.style("left",function(){var e=this.getBoundingClientRect().width,o=d3.event.pageX;return p>e+o+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px").style("opacity",1),U.transition().style("opacity",1).attr("x1",A(o)+10).attr("x2",A(o)+10).style("color","#63666A");var a=k.filter(function(e){return e[t]==o&"Total"==e.groupByValue})[0],u="The model believes that "+(S>=0?"increasing":"decreasing")+" <span>"+t+"</span> from <span> "+v.formatLabel(a[t])+" </span> to <span>"+v.formatLabel(parseFloat(a[t])+parseFloat(S))+"</span> leads to, on average, changes "+q+" by";d.forEach(function(e){var r=k.filter(function(r){return r[t]==o&r.groupByValue==e});r.length>0&&(u+=" a <span style='color:"+M[t][e]+"'>"+v.formatLabel(r[0].predictedYSmooth)+(v.formatLabel(r[0].predictedYSmooth)>=0?" increase":" decrease")+"</span> for "+e+",")}),u=u.slice(0,u.length-1)+"</span>.",b.html(u).style("color","#63666A")}function T(o){d3.selectAll(".layer"+e).style("opacity",1).attr("stroke-width","2px"),b.transition().style("opacity",0),E=!1,U.transition().style("opacity",0)}function x(o,a){var u=r();setTimeout(function(){E=!0},300);var l=k.filter(function(e){return e[t]==u&"Total"==o.groupByValue})[0];b.attr("class",""+e+a);var l=k.filter(function(e){return e[t]==u&"Total"==e.groupByValue})[0];i="";var i="The model believes that "+(S>=0?"increasing":"decreasing")+" <span>"+t+"</span> from <span> "+v.formatLabel(l[t])+" </span> to <span>"+v.formatLabel(parseFloat(l[t])+parseFloat(S))+"</span> leads to, on average, changes "+q+" by ";d.forEach(function(e){var o=k.filter(function(o){return o[t]==u&o.groupByValue==e});o.length>=0&&(i+="a <span>"+o[0].predictedYSmooth+(v.formatLabel(o[0].predictedYSmooth)>=0?" increase":" decrease")+"</span> for "+e+",")}),i+=" and an <span> overall average of "+v.formatLabel(l.predictedYSmooth)+"</span>.",b.html(i).style("color","#63666A").style("left",function(){var e=this.getBoundingClientRect().width,o=d3.event.pageX;return p>e+o+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),d3.select(this).style("opacity",1).attr("stroke-width","3px")}var w=0,H=0,k=[],O=N[t],k=u.filter(function(e){return O.indexOf(e.groupByValue)>=0});s.filter(function(e,o){var r={};r[t]=e[t];var a=0;B.forEach(function(o){var r=G.proportion.filter(function(e){return e.name==o})[0].perc/100;a+=e[o]*r}),r.predictedYSmooth=a,r.groupByValue="Total",k.push(r)});var _=V(u,t,N[t]);n.html("<ul style='list-style-type:disc' > <li>Across all categories, the impact of <b>"+t+" </b> on <b>"+q+"</b> is lowest from <b> ["+_.lowestRange+"] </b> "+_.lowestGroup+" and highest from <b> ["+_.highestRange+"] </b> "+_.highestGroup+"</li> <li> The impact of <b>"+t+" </b>  on <b>"+q+"</b> from <b> ["+_.highestRange+"]  </b>"+_.highestGroup+" is  "+v.formatLabel(_.diffMaxOverall)+" higher than the overall median imapct and "+v.formatLabel(_.diffMaxMin)+" higher than the average impact from <b> ["+_.lowestRange+"] </b>"+_.lowestGroup+"</li> </ul>");var Z=[];for(var J in z){var $=0,K=0;for(var ee in N[t]){var oe=N[t][ee],re=N[t].length==B.length?g(Y,z[J],oe,t):m(Y,z[J],oe,t),ae=G.proportion.filter(function(e){return e.name==oe})[0].perc/100;$+=re*ae,K+=ae}Z.push({percentile:z[J],value:v.formatLabel($/K)})}k=k.sort(function(e,o){return e[t]-o[t]}),A.domain(d3.extent(k,function(e){return e[t]})),k.forEach(function(e){w=d3.min([w,e.predictedYSmooth]),H=d3.max([H,e.predictedYSmooth])}),C.domain([w,H]);var ue=d3.axisBottom().scale(A);if(P.transition().duration(1e3).call(F),L&0!=N[t].length){var te=I.selectAll("line").data(Z).style("opacity",1);te.exit().remove(),te.enter().append("line").style("opacity",1).attr("x1",function(e){return A(e.value)}).attr("y1",30*R+40).attr("x2",function(e){return A(e.value)}).attr("y2",l+30*R+20).attr("stroke","#75787B").attr("stroke-width","2px"),te.transition().attr("x1",function(e){return A(e.value)}).attr("y1",30*R+40).attr("x2",function(e){return A(e.value)}).attr("y2",l+30*R+20).attr("stroke","#75787B").attr("stroke-width","2px");var pe=j.selectAll("text").data(Z).style("opacity",1);pe.exit().remove(),pe.enter().append("text").text(function(e){return e.percentile}).attr("transform",function(e){return"translate("+(A(e.value)-5)+",65)"}),pe.transition().text(function(e){return e.percentile}).attr("transform",function(e){return"translate("+(A(e.value)-5)+",65)"})}0==N[t].length&&(I.selectAll("line").style("opacity",0),j.selectAll("text").style("opacity",0)),P.selectAll("line").attr("opacity",.05).style("stroke-dasharray","5, 5"),X.call(ue),Q.selectAll(".path").remove();var le=Q.selectAll(".path").data(O);le.exit().transition().duration(500).remove(),le.enter().append("path").attr("fill","none").attr("class",function(o){return"path layer"+o+" path"+o+e+" layer"+e}).attr("stroke",function(e){return M[t][e]}).attr("stroke-width","2px").datum(function(e){var o=[];return k.map(function(r){r.groupByValue==e&&o.push(r)}),o}).style("cursor","pointer").attr("d",D).on("mouseenter",x).on("mousemove",f).on("mouseout",T);c.selectAll("button").data(d.sort(v.sortAlphaNum)).enter().append("button").attr("class","legend-btn").style("background-color",function(e){return M[t][e]}).style("cursor","pointer").on("click",h).on("mouseover",i).on("mouseout",y).html(function(e){return e});W.on("mouseenter",x).on("mousemove",f).on("mouseout",T)}function r(){var e=A.invert(d3.event.pageX-.02*v.getWidth()),o=Y.map(function(e){return e[t]}),r=i(e,o);return r}function i(e,o){for(var r=o[0],a=Math.abs(e-r),u=0;u<o.length;u++){var t=Math.abs(e-o[u]);t<a&&(a=t,r=o[u])}return r}var d=[],B=[];u.forEach(function(e){d.indexOf(e.groupByValue)<0&&d.push(e.groupByValue)}),f.AppData[e].Data.forEach(function(e){B.indexOf(e.groupByValue)<0&e.groupByVarName==O&&B.push(e.groupByValue)});var s=[],T=d3.nest().key(function(e){return e[t]}).entries(f.AppData[e].Data);T.forEach(function(o){var r={};r[t]="Continuous"==f.AppData[e].Type?parseFloat(o.key):o.key,B.forEach(function(e){var a=o.values.filter(function(o){return o.groupByValue==e});1==a.length?r[e]=a[0].predictedYSmooth:r[e]=null}),s.push(r)}),k=v.createChart(h,p),v.setTitle(y,"Impact of "+(S>=0?"increasing":"decreasing")+" "+t+" by "+S+(f.AppData[e].Change.indexOf("Default")>=0?" (1 standard deviation) ":"")+" on "+q),k.selectAll("*").remove(),k.attr("width",p),d=d.sort(v.sortAlphaNum);var x=140,w=parseInt(p/x),R=Math.ceil(d.length/w),W=k.append("rect").attr("class","overlay").attr("width",p-a.left).attr("height",l).attr("x",a.left).attr("y",a.top+30*R).style("fill","none").style("cursor","pointer").style("pointer-events","all"),H=k.append("g").attr("transform","translate(100,"+(l+30*R+55)+")");H.append("line").attr("x1",0).attr("y1",0).attr("x2",20).attr("y2",0).attr("stroke","#75787B").attr("stroke-width","3px"),H.append("text").text("Percentile").attr("x",30).attr("y",5);k.attr("height",300+30*R);var A=d3.scaleLinear().range([a.left,p]),C=d3.scaleLinear().range([l-30,0]),D=d3.line().x(function(e){return A(e[t])}).y(function(e){return C(e.predictedYSmooth)}).curve(d3.curveBasis),I=k.append("g").attr("class","percRefLines").attr("transform","translate(10,0)"),j=k.append("g").attr("class","textRefLines").attr("transform","translate(10,0)"),X=k.append("g").attr("class","xAxis").attr("transform","translate(10,"+(l+30*R+20)+")"),P=k.append("g").attr("class","yAxis").attr("transform","translate(60,70)"),Q=k.append("g").attr("class","lineG").attr("transform","translate(10,"+(30*R+40)+")"),U=(k.append("g").attr("class","lineGT").attr("transform","translate(10,"+(30*R+40)+")"),k.append("text").attr("class","label").attr("transform","translate("+p/2+","+(l+30*R+60)+")").style("text-anchor","middle").text(t),k.append("text").attr("class","label").attr("transform","translate(15,"+(l-50)+")rotate(-90)").style("text-anchor","middle").text("Impact on "+q),k.append("line").style("opacity",0).attr("x1",0).attr("y1",30*R+30).attr("x2",0).attr("y2",l+30*R+20).attr("stroke","#75787B"));C.domain([-1,1]);var F=d3.axisLeft().scale(C).tickSizeInner(-p+a.left-10);P.call(F),o(!1)}function r(){function o(e){var o=[];return e.forEach(function(e){o.indexOf(e[t])<0&&o.push(e[t])}),o}function r(){function o(o,r){b.attr("class","colorClass"+e+r),b.transition().duration(200).delay(100).style("opacity",1),b.html("Within the <span>"+o.key+" </span> group, the model believes that changing <span>"+t+"</span> from <span> "+o.parent+" </span> to <span>"+S+"</span> leads to, on average, a <span>"+Math.abs(v.formatLabel(o.value))+(v.formatLabel(o.value)>=0?" increase":" decrease")+"</span> in "+q).style("left",function(){var e=this.getBoundingClientRect().width,o=d3.event.pageX;return p>e+o+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),b.style("color",M[t][o]),d3.selectAll(".layer"+e).style("opacity","0.4"),d3.select(this).style("opacity",1).style("stroke","black").style("stroke-width","1px")}function a(o,r){b.attr("class","colorClass"+e+r),b.transition().duration(200).delay(100).style("opacity",1),b.html("Within the <span>"+o.key+" </span> group, the model believes that changing <span>"+t+"</span> from <span> "+o.parent+" </span> to <span>"+S+"</span> leads to, on average, a <span>"+Math.abs(v.formatLabel(o.value))+(v.formatLabel(o.value)>=0?" increase":" decrease")+"</span> in "+q).style("left",function(){var e=this.getBoundingClientRect().width,o=d3.event.pageX;return p>e+o+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),b.style("color",M[t][o.key]),d3.selectAll(".layer"+e).style("opacity","0.4"),d3.select(this).style("opacity",1).style("stroke","black").style("stroke-width","1px")}function l(e,o){b.transition().style("opacity",0),E=!1,W.transition().style("opacity",0),d3.select(this).style("stroke-width","0px")}function y(e,o){d3.selectAll(".rect"+e.replace(/[^a-zA-Z]/g,"")).style("stroke","black").style("stroke-width","1px")}function h(e,o){d3.selectAll(".rect"+e.replace(/[^a-zA-Z]/g,"")).style("stroke","black").style("stroke-width","0px")}function g(e,o){N[t].indexOf(e)>=0?(N[t].splice(N[t].indexOf(e),1),r(!1),d3.select(this).style("opacity",.5).style("background-color","#A7A8AA")):(N[t].push(e),r(!1),d3.select(this).style("opacity",1).style("background-color",M[t][e]))}function V(e,o){e.each(function(){for(var e,r=d3.select(this),a=(r.text()+" → "+S).split(/\s+/).reverse(),u=[],p=0,l=1.1,d=r.attr("y"),y=parseFloat(r.attr("dy")),c=r.text(null).append("tspan").attr("x",0).attr("y",d).attr("dy",y+"em");e=a.pop();)u.push(e),c.text(u.join(" ")),c.node().getComputedTextLength()>o&&(u.pop(),c.text(u.join(" ")),u=[e],c=r.append("tspan").attr("x",0).attr("y",d).attr("dy",++p*l+y+"em").text(e));i=d3.max([450+20*p,i]),d3.select("#topchlvl-"+t.replace(/[^a-zA-Z]/g,"")).style("height",i+10+"px"),d3.select("#chlvl-"+t.replace(/[^a-zA-Z]/g,"")).style("height",i+"px")})}k=d3.select("#chlvl-"+t.replace(/[^a-zA-Z]/g,"")).select("svg");var s=m.filter(function(e){return N[t].indexOf(e)>=0}),A=0,C=0;Y.forEach(function(e){var o=d3.min(s,function(o){return e[o]}),r=d3.max(s,function(o){return e[o]});o<A&&(A=o),r>C&&(C=r)}),A=A>0?.9*A:1.1*A,C=C>0?1.1*C:.9*C;var D=[A>0?0:A,C<0?0-.1*A:C];x.domain(D),f.domain(d),T.domain(s).rangeRound([0,f.bandwidth()]);var L=B(u,t,N[t],d);n.html("<ul style='list-style-type:disc' > <li>Across all categories, the impact of <b>"+t+" </b> on <b>"+q+"</b> is lowest for <b> "+L.lowestQuartile+" </b>  "+L.lowestGroup+" and highest for <b> "+L.highestQuartile+" </b> "+L.highestGroup+"</li> <li> The impact of <b>"+t+" </b>  on <b>"+q+"</b> for <b>"+L.highestQuartile+" </b> "+L.highestGroup+" is  "+v.formatLabel(L.diffMaxOverall)+" higher than the overall median impact and "+v.formatLabel(L.diffMaxMin)+" higher than the average impact from <b>"+L.lowestQuartile+"</b> "+L.lowestGroup+"</li>  </ul>");var z=d3.axisBottom().scale(f);w.transition().duration(1e3).call(H),R.selectAll("g").remove(),R.selectAll("g").data(d).enter().append("g").attr("transform",function(e){return"translate("+f(e)+",0)"}).selectAll("rect").data(function(e){return s.map(function(o){if(N[t].indexOf(o)>=0){var r={};return r.parent=e,r.key=o,r.value=Y.filter(function(o){return o[t]==e})[0][o],r}})}).enter().append("rect").attr("class",function(e){return"rect"+e.key.replace(/[^a-zA-Z]/g,"")}).attr("x",function(e){return T(e.key)}).attr("y",function(e){return x(x(e.value)>=x(0)?0:e.value)}).attr("width",T.bandwidth()).attr("height",function(e){return x(e.value)-x(0)==0?1:x(e.value)-x(0)>=0?x(e.value)-x(0):x(0)-x(e.value)}).attr("fill",function(e,o){return M[t][e.key]}).on("mouseover",o).on("mousemove",a).on("mouseout",l).style("cursor","pointer").style("stroke",function(e){return"#000"}).style("stroke-width","0px"),w.selectAll("line").attr("opacity",.15).style("stroke-dasharray","4, 4"),k.select(".xAxis").call(z).attr("transform","translate(0,"+(x(0)+70)+")"),k.select(".xAxis").selectAll("text").attr("x",function(e){return 0}).attr("transform","translate(0,"+(x(D[0])-x(0))+")").call(V,.9*f.bandwidth());c.selectAll("button").data(m).enter().append("button").attr("class","legend-btn").style("background-color",function(e){return M[t][e]}).on("click",g).on("mouseover",y).on("mouseout",h).style("cursor","pointer").html(function(e){return e})}var i=0,d=o(Y);k=v.createChart(h,p);var m=[];u.forEach(function(e){m.indexOf(e.groupByValue)<0&&m.push(e.groupByValue)}),v.setTitle(y,"Sensitivity Plot: Impact of Changing "+t),m=m.sort(v.sortAlphaNum),k.selectAll("*").remove(),p/(d.length*m.length)<=20&&(p=d.length*m.length*20),k.attr("width",p);var g=140,V=parseInt(p/g),s=Math.ceil(m.length/V);k.attr("height",300+30*s);var f=d3.scaleBand().range([a.left,p]).paddingInner(.25),T=d3.scaleBand().padding(.25),x=d3.scaleLinear().range([l,0]);k.append("g").attr("class","xAxis").attr("transform","translate(10,"+(l+30*s+20)+")");var w=k.append("g").attr("class","yAxis").attr("transform","translate(60,70)"),R=k.append("g").attr("transform","translate(0,70)"),W=(k.append("text").attr("class","label").attr("transform","translate("+p/2+","+30*s+")").style("text-anchor","middle").text(t),k.append("text").attr("class","label").attr("transform","translate(15,"+(l-50)+")rotate(-90)").style("text-anchor","middle").text("Impact on "+q),k.append("line").style("opacity",0).attr("x1",0).attr("y1",30*s).attr("x2",0).attr("y2",l+30*s+10).attr("stroke","#75787B"));x.domain([-1,1]);var H=d3.axisLeft().scale(x).tickSizeInner(-p+a.left);w.call(H),r()}q=G.yVar;var a={top:30,right:15,bottom:60,left:60},u=f.AppData[e].Data.filter(function(e){return e.groupByVarName==O&&I.indexOf(e.groupByValue)<0});if(0==u.length)return null;var t=Object.keys(f.AppData[e].Data[0]).filter(function(e){return D.indexOf(e)<0})[0],p=.74*v.getWidth()-a.left-a.right,l=300-a.top-a.bottom,i=W.append("div").attr("class","chart-lev").attr("id","topchlvl-"+t.replace(/[^a-zA-Z]/g,"")),d=i.append("div").attr("class","app").attr("id","chlvl-"+t.replace(/[^a-zA-Z]/g,"")).style("height","450px"),y=d.append("div").attr("class","Title"),c=d.append("div").attr("class","legend").attr("width",p-100).attr("height",l-100),h=(d.append("div").attr("class","Filtercontainer"),d.append("div").attr("class","Total"),d.append("div").attr("class","Chartcont")),s=i.append("div").attr("class","desc").style("height","560px"),n=s.append("div").attr("class","desc-text").html("Few Insights will come here"),S=(d.append("div").attr("class","Source"),d.append("div").attr("class","Attribution"),""),N={};N[t]=[],u.forEach(function(e){N[t].indexOf(e.groupByValue)<0&&N[t].push(e.groupByValue)});var Y=[],T=d3.nest().key(function(e){return e[t]}).entries(u);T.forEach(function(o){var r={};r[t]="Continuous"==f.AppData[e].Type?parseFloat(o.key):o.key,N[t].forEach(function(e){var a=o.values.filter(function(o){return o.groupByValue==e});1==a.length?r[e]=a[0].predictedYSmooth:r[e]=null}),Y.push(r)});Y[0];"Continuous"==f.AppData[e].Type?(S=v.formatLabel(f.AppData[e].Change.indexOf("Default")>=0?f.AppData[e].Change.split(":")[1]:f.AppData[e].Change),o()):"Categorical"==f.AppData[e].Type&&(S=f.AppData[e].Change.indexOf("Default")>=0?f.AppData[e].Change.split(":")[1]:f.AppData[e].Change,r())}var N=r(2),Y=a(N),f=r(1);r(6);var v=new Y.default,T=d3.select("#App"),x=(T.append("div").attr("class","heading").append("a").attr("href","https://github.com/DataScienceSquad/WhiteBox_Production").html("White Box - Impact By Variable"),T.append("div").attr("class","subheading").append("a").attr("href","https://github.com/DataScienceSquad/WhiteBox_Production/wiki/How-to-interpret-WhiteBox-charts").html("How to interpret WhiteBox Charts"),T.append("div").attr("class","summary")),w=x.append("div").attr("class","heatMapContainer"),R=x.append("div").attr("class","filt-cont"),W=T.append("div").attr("class","Chartcontainer"),b=d3.select("body").append("div").attr("id","tooltip").style("opacity",0);d3.select("body").on("click",function(){E&&(b.style("opacity",0),E=!1)});var H,k,A,C=["#86BC25","#00A3E0","#00ABAB","#C4D600","#2C5234","#9DD4CF","#004F59","#62B5E5","#43B02A","#0076A8","#9DD4CF","#012169"],D=["predictedYSmooth","groupByVarName","groupByValue","highlight","errNeg","errPos"],L=!0,q="Quality",E=!1,z=[10,50,90],M={},O="",I=[],G={};A=v.createChart(w,H),window.togglePercentile=t,window.intializeTreeMap=y,n(),h(),p(),y(f.AppData[0].Data[0].groupByVarName),window.onresize=function(){d3.select(".Chartcontainer").selectAll("*").remove(),H=v.getWidth(),y(f.AppData[0].Data[0].groupByVarName)}},function(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=<***>;o.AppData=r},function(e,o){"use strict";function r(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(e,o){for(var r=0;r<o.length;r++){var a=o[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(o,r,a){return r&&e(o.prototype,r),a&&e(o,a),o}}(),u=function(){function e(){r(this,e)}return a(e,[{key:"setTitle",value:function(e,o){e.selectAll("*").remove();e.append("span").html(o)}},{key:"setLabel",value:function(e,o){e.selectAll("*").remove();e.append("span").html(o)}},{key:"setSource",value:function(e,o){e.selectAll("*").remove(),e.html(o)}},{key:"formatLabel",value:function(e){return e=d3.format(".3f")(e),e=e.replace(/\.0$/,"")}},{key:"createChart",value:function(e,o){var r=e.append("svg");return r.attr("width",o),r}},{key:"getWidth",value:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},{key:"sortDictionary",value:function(e,o){var r=e.name.toLowerCase(),a=o.name.toLowerCase();return r<a?-1:r>a?1:0}},{key:"sortAlphaNum",value:function(e,o){var r=/[^a-zA-Z]/g,a=/[^0-9]/g,u=e.replace(r,""),t=o.replace(r,"");if(u===t){var p=parseInt(e.replace(a,""),10),l=parseInt(o.replace(a,""),10);return p===l?0:p>l?1:-1}return u>t?1:-1}},{key:"shortenString",value:function(e){return e.length>=20?e.slice(0,20)+"...":e}}]),e}();o.default=u},function(e,o,r){o=e.exports=r(4)(),o.push([e.id,'/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*,:after,:before{box-sizing:border-box;-webkit-tap-highlight-color:transparent}svg{overflow:visible!important}body,html{background-color:#fff;font-family:Open Sans,sans-serif}#App{overflow:hidden;width:100%}.heading{height:50px;font-size:24px;padding-top:15px}.heading,.subheading{position:fixed;margin-left:1%;width:98%;text-align:center;color:#00a3e0;font-weight:800;box-shadow:2px 2px 4px rgba(0,0,0,.247059);z-index:999;background-color:#fff}.subheading{top:50px;height:20px;font-size:12px}.filt-cont{width:24%;height:50px;float:left}.dropdown{width:100%;color:#53565a;position:relative;display:inline-block;margin-left:1%;margin-top:10px}.dropdown-content{display:none;position:absolute;background-color:#fff;z-index:1;width:100%;border:1px solid #00a3e0;border-radius:2px;border-top:none;overflow:auto;max-height:300px}.dropdown-content a{color:#53565a;padding:3px 5px;text-decoration:none;display:block;cursor:pointer}.dropdown-content a:hover{background-color:#00a3e0}.dropdown:hover .dropdown-content{display:block}.dropbtn{color:#53565a;background-color:#fff;font-size:14px;border:none;text-align:left;padding-top:3px;padding-bottom:3px;cursor:pointer;width:100%;height:30px;border:1px solid #00a3e0}.drpbtn:focus{outline:none}.heatMapContainer{height:120px;width:74%;margin-left:1%;padding-top:5px;margin-top:10px;float:left}#tooltip{position:absolute;width:auto;text-align:center;border-radius:5px;pointer-events:none;background-color:#fff;padding:8px;z-index:100;font-size:14px;max-width:300px;border:1px solid rgba(0,0,0,.1);box-shadow:4px 4px 6px rgba(0,0,0,.2);z-index:1000}#tooltip span{font-weight:700;font-size:17px}.Title{color:#000;font-size:16px;font-weight:600;padding:12px;text-align:center;text-decoration:underline;width:99%;float:left}.Source{font-weight:300;font-size:14px;padding-left:12px;padding-right:12px;text-align:left}.Source p{margin:2px}svg text{font-size:14px;fill:#53565a;font-weight:400}.app{width:74%;float:left;overflow:auto}.Chartcontainer{margin-top:150px;width:100%;float:left}.summary{padding-top:5px;margin-top:2px;height:130px;box-shadow:2px 2px 4px rgba(0,0,0,.247059);position:fixed;width:98%;top:68px;background-color:#fff;margin-left:1%;z-index:1000}.Chartcontainer button{max-width:200px;height:30px;border:none;margin-left:20px;margin-bottom:3px;font-family:Open Sans,sans-serif;font-size:16px;font-weight:600;color:#fff}.Chartcontainer button:focus{outline:0}.tick{font-weight:700}.tick line{opacity:.15}.Chartcontainer button:hover{background-color:#fff;color:#000}.legend{width:90%;margin-left:5%;display:inline-flex;justify-content:center;flex-wrap:wrap;float:left}.legend-btn{width:200px;border:2px solid #53565a!important;border-radius:2px}.label{font-size:12px;font-weight:700}.chart-lev{margin-top:50px;width:98%;box-shadow:2px 2px 4px rgba(0,0,0,.247059);margin-left:1%;display:inline-block}.desc{width:24%;float:left;margin-left:1%}.desc-text{height:320px;width:98%;margin-top:40px;padding:5px;font-size:14px;text-align:justify;overflow-y:auto}.desc-text ul{padding-left:10px}.rect{border:2px solid #53565a}.heading a,.heading a:focus,.subheading a,.subheading a:focus{color:#00a3e0}.perc-check{height:50px;width:98%;margin-left:1%;display:block;position:relative;padding-left:5px;margin-top:12px;cursor:pointer;font-size:16px;color:#53565a;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.perc-check input{cursor:pointer}.perc-checkinput,.perc-check input{position:absolute;opacity:0}.perc-checkinput+label{position:relative;cursor:pointer;padding:0;width:20px;height:20px}.perc-checkinput+label:before{content:"";margin-right:10px;display:inline-block;vertical-align:text-top;width:20px;height:20px;background:#00a3e0;color:#86bc25;border:1px solid #fff;border-radius:2px}.perc-checkinput:hover+label:before{background:#00a3e0;color:#00a3e0}.perc-checkinput:checked+label:before{color:#00a3e0;background:#00a3e0;border:1px solid #fff;border-radius:2px}.perc-checkinput:disabled+label{color:#63666a;cursor:auto}.perc-checkinput:disabled+label:before{box-shadow:none;background:#00a3e0}.perc-checkinput:checked+label:after{content:"";position:absolute;left:4px;top:8px;background:#fff;width:3px;height:3px;box-shadow:2px 0 0 #fff,4px 0 0 #fff,4px -2px 0 #fff,4px -4px 0 #fff,4px -6px 0 #fff,4px -8px 0 #fff;transform:rotate(45deg)}',""])},function(e,o){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],o=0;o<this.length;o++){var r=this[o];r[2]?e.push("@media "+r[2]+"{"+r[1]+"}"):e.push(r[1])}return e.join("")},e.i=function(o,r){"string"==typeof o&&(o=[[null,o,""]]);for(var a={},u=0;u<this.length;u++){var t=this[u][0];"number"==typeof t&&(a[t]=!0)}for(u=0;u<o.length;u++){var p=o[u];"number"==typeof p[0]&&a[p[0]]||(r&&!p[2]?p[2]=r:r&&(p[2]="("+p[2]+") and ("+r+")"),e.push(p))}},e}},function(e,o,r){function a(e,o){for(var r=0;r<e.length;r++){var a=e[r],u=m[a.id];if(u){u.refs++;for(var t=0;t<u.parts.length;t++)u.parts[t](a.parts[t]);for(;t<a.parts.length;t++)u.parts.push(d(a.parts[t],o))}else{for(var p=[],t=0;t<a.parts.length;t++)p.push(d(a.parts[t],o));m[a.id]={id:a.id,refs:1,parts:p}}}}function u(e){for(var o=[],r={},a=0;a<e.length;a++){var u=e[a],t=u[0],p=u[1],l=u[2],i=u[3],d={css:p,media:l,sourceMap:i};r[t]?r[t].parts.push(d):o.push(r[t]={id:t,parts:[d]})}return o}function t(e,o){var r=B(),a=S[S.length-1];if("top"===e.insertAt)a?a.nextSibling?r.insertBefore(o,a.nextSibling):r.appendChild(o):r.insertBefore(o,r.firstChild),S.push(o);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(o)}}function p(e){e.parentNode.removeChild(e);var o=S.indexOf(e);o>=0&&S.splice(o,1)}function l(e){var o=document.createElement("style");return o.type="text/css",t(e,o),o}function i(e){var o=document.createElement("link");return o.rel="stylesheet",t(e,o),o}function d(e,o){var r,a,u;if(o.singleton){var t=n++;r=s||(s=l(o)),a=y.bind(null,r,t,!1),u=y.bind(null,r,t,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=i(o),a=h.bind(null,r),u=function(){p(r),r.href&&URL.revokeObjectURL(r.href)}):(r=l(o),a=c.bind(null,r),u=function(){p(r)});return a(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;a(e=o)}else u()}}function y(e,o,r,a){var u=r?"":a.css;if(e.styleSheet)e.styleSheet.cssText=N(o,u);else{var t=document.createTextNode(u),p=e.childNodes;p[o]&&e.removeChild(p[o]),p.length?e.insertBefore(t,p[o]):e.appendChild(t)}}function c(e,o){var r=o.css,a=o.media;if(a&&e.setAttribute("media",a),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function h(e,o){var r=o.css,a=o.sourceMap;a&&(r+="\\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var u=new Blob([r],{type:"text/css"}),t=e.href;e.href=URL.createObjectURL(u),t&&URL.revokeObjectURL(t)}var m={},g=function(e){var o;return function(){return"undefined"==typeof o&&(o=e.apply(this,arguments)),o}},V=g(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),B=g(function(){return document.head||document.getElementsByTagName("head")[0]}),s=null,n=0,S=[];e.exports=function(e,o){o=o||{},"undefined"==typeof o.singleton&&(o.singleton=V()),"undefined"==typeof o.insertAt&&(o.insertAt="bottom");var r=u(e);return a(r,o),function(e){for(var t=[],p=0;p<r.length;p++){var l=r[p],i=m[l.id];i.refs--,t.push(i)}if(e){var d=u(e);a(d,o)}for(var p=0;p<t.length;p++){var i=t[p];if(0===i.refs){for(var y=0;y<i.parts.length;y++)i.parts[y]();delete m[i.id]}}}};var N=function(){var e=[];return function(o,r){return e[o]=r,e.filter(Boolean).join("\\n")}}()},function(e,o,r){var a=r(3);"string"==typeof a&&(a=[[e.id,a,""]]);r(5)(a,{});a.locals&&(e.exports=a.locals)}]);
