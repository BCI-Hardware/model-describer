!function(e){function r(a){if(o[a])return o[a].exports;var t=o[a]={exports:{},id:a,loaded:!1};return e[a].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}var o={};return r.m=e,r.c=o,r.p="",r(0)}([function(e,r,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function t(e,r){var o=e.data.name;z.indexOf(o)>=0?(z.splice(z.indexOf(o),1),d3.select(this).attr("fill",D.heat[o])):(z.push(o),d3.select(this).attr("fill","#A7A8AA")),F.selectAll("*").remove();for(var a=0;a<v.AppData.length;a++)S(a)}function l(){w=document.getElementById("percentileCheck").checked,d3.select(".Chartcontainer").selectAll("*").remove(),A=P.getWidth(),g(v.AppData[0].Data[0].groupByVarName)}function i(){var e=y(),r=Y.append("div").attr("class","dropdown");console.log(E),r.append("button").attr("class","dropbtn").html("<b>Group By:</b> "+P.shortenString(E)).append("span").style("float","right").html(" ▼");var o=r.append("div").attr("class","dropdown-content");o.selectAll("a").data(e).enter().append("a").html(function(e){return e}).attr("onclick",function(e){return"intializeTreeMap('"+e+"')"});Y.append("div").attr("class","perc-check").html("<input id='percentileCheck' class='perc-checkinput' checked='true' onchange='togglePercentile()' type='checkbox'><label for='percentileCheck'>Percentiles</label>")}function n(e,r){setTimeout(function(){T=!0},300);var o=I.statData.filter(function(r){return r.groupByVarName==E&&r.groupByValue==e.data.name})[0],a=I.proportion.filter(function(r){return r.name==e.data.name})[0];q.style("opacity",1).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px").style("color",D.heat[e]).html("Group <b>"+o.groupByValue+" </b> is "+a.perc+"% of the data and has an average error of <b>"+P.formatLabel(o[I.ErrType])+"</b>")}function u(e,r){setTimeout(function(){T=!0},300);var o=I.statData.filter(function(r){return r.groupByVarName==E&&r.groupByValue==e.data.name})[0],a=I.proportion.filter(function(r){return r.name==e.data.name})[0];q.style("opacity",1).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px").style("color",D.heat[e.data.name]).html("Group <b>"+o.groupByValue+" </b> is "+P.formatLabel(a.perc)+"% of the data and has an average error of <b>"+P.formatLabel(o[I.ErrType])+"</b>")}function c(e,r){q.style("opacity",0)}function g(e){function r(e){return e.children?0:1}function o(e){return e.size}E=e,B(),d3.select(".dropbtn").html("<b>Group By:</b> "+P.shortenString(E)).append("span").style("float","right").html(" ▼");var a=p(E),l={top:50,right:15,bottom:30,left:60};M.selectAll("*").remove();var i=.8*P.getWidth()-.1*l.left-l.right-.1*P.getWidth(),g=200-l.top-l.bottom;M.attr("width",i),M.attr("height",g);var y=function(e){return d3.interpolateRgb(e,"#fff")(.2)},m=(d3.scaleOrdinal(d3.schemeCategory20.map(y)),d3.format(",d"),d3.treemap().tile(d3.treemapResquarify).size([i,g-20]).round(!0).paddingInner(2)),s=d3.hierarchy(a).eachBefore(function(e){e.data.id=(e.parent?e.parent.data.id+".":"")+e.data.name}).sum(o).sort(function(e,r){return r.data.name-e.data.name});I.proportion=s.data.children;var h=0;for(var d in I.proportion)h+=I.proportion[d].size;for(var d in I.proportion)I.proportion[d].perc=100*I.proportion[d].size/h;m(s);var V=M.append("g").attr("class","cell-group").attr("transform","translate(0,0)"),N=V.selectAll("g").data(s.leaves()).enter().append("g").attr("transform",function(e){return"translate("+e.x0+","+e.y0+")"});N.append("rect").attr("id",function(e){return e.data.id+" brdr"}).attr("x",-2).attr("y",-2).attr("class","borderpath").attr("width",function(e){return e.x1-e.x0+4}).attr("height",function(e){return e.y1-e.y0+4}).attr("fill",function(e){return"#53565A"}).style("cursor","pointer"),N.append("rect").attr("id",function(e){return e.data.id}).attr("class","rect").attr("width",function(e){return e.x1-e.x0}).attr("height",function(e){return e.y1-e.y0}).attr("fill",function(e){return D.heat[e.data.name]}).on("click",t).on("mouseenter",n).on("mouseout",c).on("mousemove",u).style("cursor","pointer"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",20).text(function(e){if(e.x1-e.x0>100){var r=I.statData.filter(function(r){return r.groupByVarName==E&&r.groupByValue==e.data.name})[0],o=I.proportion.filter(function(r){return r.name==e.data.name})[0];return"Category: "+r.groupByValue+" ("+P.formatLabel(o.perc)+"%)"}return""}).style("fill","#fff"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",40).text(function(e){if(e.x1-e.x0>100){var r=I.statData.filter(function(r){return r.groupByVarName==E&&r.groupByValue==e.data.name})[0];return"Average Error: "+P.formatLabel(r[I.ErrType])}return""}).style("fill","#fff"),N.append("text").attr("clip-path",function(e){return"url(#clip-"+e.data.id+")"}).attr("dx",10).attr("dy",60).text(function(e){if(e.x1-e.x0>100){I.statData.filter(function(r){return r.groupByVarName==E&&r.groupByValue==e.data.name})[0];return"Error Type: "+I.ErrType}return""}).style("fill","#fff"),d3.selectAll("input").data([o,r],function(e){return e?e.name:this.value}),F.selectAll("*").remove();for(var C=0;C<v.AppData.length;C++)S(C)}function p(e){var r={name:"heatMap",children:[]},o=v.AppData[0].Data,a=o.filter(function(r){return r.groupByVarName==e}),t=I.statData.filter(function(r){return r.groupByVarName==e});console.log(a);var l=d3.nest().key(function(e){return e.groupByValue}).rollup(function(e){return e.length}).entries(t);return l.forEach(function(e){var o={};o.name=e.key,o.size=t.filter(function(r){return r.groupByValue==e.key})[0].Total,r.children.push(o)}),r.children=r.children.sort(P.sortDictionary),r}function y(){var e=[];return v.AppData.forEach(function(r){r.Data.forEach(function(r){e.indexOf(r.groupByVarName)<0&&e.push(r.groupByVarName)})}),e}function m(e,r,o,a){var t=I.percData.filter(function(e){return e.variable==a})[0],l=t.percentileList.filter(function(e){return e.groupByVar==o})[0],i=l.percentileValues.filter(function(e){return e.percentiles==r+"%"})[0];return i.value}function s(e,r,o,a){var t=I.percGData.filter(function(e){return e.variable==a&e.percentile==r+"%"})[0];return t.value}function h(e,r,o){if(0==o.length)return 0;var a=d3.extent(e.map(function(e){return e[r]})),t={},l={};l.overEst="",l.underEst="",t.quartiles=[];for(var i=(d3.quantile(a,.25)-d3.min(a),1);i<=4;i++)for(var n in o){var u=o[n],c={};c.quarter=i,c.group=u;var g=m(e,25*(i-1),u,r),p=m(e,25*i,u,r);c.range=[g,p];var y=e.filter(function(e){return e[r]>=g&&e[r]<=p&&e.groupByValue==u});c.averageImpact=d3.mean(y.map(function(e){return e.predictedYSmooth})),c.medianImpact=d3.median(y.map(function(e){return e.predictedYSmooth})),c.estimate=Math.abs(d3.mean(y.map(function(e){return e.predictedYSmooth}))/d3.mean(y.map(function(e){return e.predictedYSmooth}))),c.estimate>=1?l.overEst+=P.formatLabel(g)+"-"+P.formatLabel(p)+", ":l.underEst+=P.formatLabel(g)+"-"+P.formatLabel(p)+", ",t.quartiles.push(c)}return l.lowest=d3.min(t.quartiles.map(function(e){return e.averageImpact})),l.highest=d3.max(t.quartiles.map(function(e){return e.averageImpact})),l.lowestGroup=t.quartiles.filter(function(e){return e.averageImpact==l.lowest})[0].group,l.lowestGroup=l.lowestGroup.indexOf("Bin")>=0?"for group "+l.lowestGroup.split("_")[1]:" for "+l.lowestGroup,l.highestGroup=t.quartiles.filter(function(e){return e.averageImpact==l.highest})[0].group,l.highestGroup=l.highestGroup.indexOf("Bin")>=0?"for group "+l.highestGroup.split("_")[1]:" for "+l.highestGroup,l.lowestQuartile=t.quartiles.filter(function(e){return e.averageImpact==l.lowest})[0].range,l.highestQuartile=t.quartiles.filter(function(e){return e.averageImpact==l.highest})[0].range,l.lowestRange=l.lowestQuartile,l.highestRange=l.highestQuartile,l.overAllAverageImpact=d3.mean(e.map(function(e){return e.predictedYSmooth})),l.overAllMedianImpact=d3.median(e.map(function(e){return e.predictedYSmooth})),l.diffMaxOverall=l.highest-l.overAllMedianImpact,l.diffMaxMin=l.highest-l.lowest,l}function d(e,r,o,a){var t=d3.extent(e.map(function(e){return e[r]})),l={},i={};i.overEst="",i.underEst="",l.quartiles=[];var n=d3.quantile(t,.25)-d3.min(t);for(var u in a)for(var c in o){var g=a[u],p=o[c],y={};y.quarter=g,y.group=p;var m=e.filter(function(e){return e[r]==g&&e.groupByValue==p});y.averageImpact=d3.mean(m.map(function(e){return e.predictedYSmooth})),y.medianImpact=d3.median(m.map(function(e){return e.predictedYSmooth})),y.estimate=Math.abs(d3.mean(m.map(function(e){return e.predictedYSmooth}))/d3.mean(m.map(function(e){return e.predictedYSmooth}))),y.estimate>=1?i.overEst+=g+", ":i.underEst+=g+", ",l.quartiles.push(y)}return i.lowest=d3.min(l.quartiles.map(function(e){return e.averageImpact})),i.highest=d3.max(l.quartiles.map(function(e){return e.averageImpact})),i.lowestGroup=l.quartiles.filter(function(e){return e.averageImpact==i.lowest})[0].group,i.lowestGroup=i.lowestGroup.indexOf("Bin")>=0?"for group "+i.lowestGroup.split("_")[1]:" for "+i.lowestGroup,i.highestGroup=l.quartiles.filter(function(e){return e.averageImpact==i.highest})[0].group,i.highestGroup=i.highestGroup.indexOf("Bin")>=0?"for group "+i.highestGroup.split("_")[1]:" for "+i.highestGroup,i.lowestQuartile=l.quartiles.filter(function(e){return e.averageImpact==i.lowest})[0].quarter,i.highestQuartile=l.quartiles.filter(function(e){return e.averageImpact==i.highest})[0].quarter,i.lowestRange=[P.formatLabel(d3.min(t)+n*(i.lowestQuartile-1)),P.formatLabel(d3.min(t)+n*i.lowestQuartile)],i.highestRange=[P.formatLabel(d3.min(t)+n*(i.highestQuartile-1)),P.formatLabel(d3.min(t)+n*i.highestQuartile)],i.overAllAverageImpact=d3.mean(e.map(function(e){return e.predictedYSmooth})),i.overAllMedianImpact=d3.median(e.map(function(e){return e.predictedYSmooth})),i.diffMaxOverall=i.highest-i.overAllMedianImpact,i.diffMaxMin=i.highest-i.lowest,i}function B(){for(var e=[],r=0;r<v.AppData.length;r++){var o=v.AppData[r].Data.filter(function(e){return e.groupByVarName==E});if(o.length>0){var a=o[0],t=Object.keys(a).filter(function(e){return L.indexOf(e)<0})[0];D[t]={},D.heat={},o.forEach(function(r){e.indexOf(r.groupByValue)<0&&e.push(r.groupByValue)}),e.sort(P.sortAlphaNum),e.forEach(function(e,r){D[t][e]=x[r]})}}e.forEach(function(e,r){D.heat[e]=x[r]})}function V(){v.AppData.filter(function(e,r){"Accuracy"==e.Type&&(I.statData=e.Data,I.ErrType=e.ErrType,v.AppData.splice(r,1))}),v.AppData.filter(function(e,r){"PercentileGroup"==e.Type&&(I.percData=e.Data,v.AppData.splice(r,1))}),v.AppData.filter(function(e,r){"Percentile"==e.Type&&(I.percGData=e.Data,v.AppData.splice(r,1))})}function S(e){function r(){function r(a){function u(r,o){d3.selectAll(".layer"+e).style("opacity",.25),d3.selectAll(".path"+r+e).style("opacity",1).attr("stroke-width","3px")}function g(r,o){d3.selectAll(".layer"+e).style("opacity",1).attr("stroke-width","2px")}function y(e,o){N[l].indexOf(e)>=0?(N[l].splice(N[l].indexOf(e),1),r(!1),d3.select(this).style("opacity",.5).style("background-color","#A7A8AA")):(N[l].push(e),r(!1),d3.select(this).style("opacity",1).style("background-color",D[l][e]))}function v(e){var r=o();q.style("left",function(){var e=this.getBoundingClientRect().width,r=d3.event.pageX;return i>e+r+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px").style("opacity",1),Q.transition().style("opacity",1).attr("x1",M(r)+10).attr("x2",M(r)+10).style("color","#63666A");var a=b.filter(function(e){return e[l]==r&"Total"==e.groupByValue})[0],t="The model believes that "+(S>=0?"increasing":"decreasing")+" <span>"+l+"</span> from <span> "+P.formatLabel(a[l])+" </span> to <span>"+P.formatLabel(parseFloat(a[l])+parseFloat(S))+"</span> leads to, on average, changes "+O+" by";c.forEach(function(e){var o=b.filter(function(o){return o[l]==r&o.groupByValue==e});o.length>0&&(t+=" a <span style='color:"+D[l][e]+"'>"+P.formatLabel(o[0].predictedYSmooth)+(P.formatLabel(o[0].predictedYSmooth)>=0?" increase":" decrease")+"</span> for "+e+",")}),t=t.slice(0,t.length-1)+P.formatLabel(a.predictedYSmooth)+"</span>.",q.html(t).style("color","#63666A")}function k(r){d3.selectAll(".layer"+e).style("opacity",1).attr("stroke-width","2px"),q.transition().style("opacity",0),T=!1,Q.transition().style("opacity",0)}function f(r,a){var t=o();setTimeout(function(){T=!0},300);var n=b.filter(function(e){return e[l]==t&"Total"==r.groupByValue})[0];q.attr("class",""+e+a);var n=b.filter(function(e){return e[l]==t&"Total"==e.groupByValue})[0];u="";var u="The model believes that "+(S>=0?"increasing":"decreasing")+" <span>"+l+"</span> from <span> "+P.formatLabel(n[l])+" </span> to <span>"+P.formatLabel(parseFloat(n[l])+parseFloat(S))+"</span> leads to, on average, changes "+O+" by ";c.forEach(function(e){var r=b.filter(function(r){return r[l]==t&r.groupByValue==e});r.length>=0&&(u+="a <span>"+r[0].predictedYSmooth+(P.formatLabel(r[0].predictedYSmooth)>=0?" increase":" decrease")+"</span> for "+e+",")}),u+=" and an <span> overall average of "+P.formatLabel(n.predictedYSmooth)+"</span>.",q.html(u).style("color","#63666A").style("left",function(){var e=this.getBoundingClientRect().width,r=d3.event.pageX;return i>e+r+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),d3.select(this).style("opacity",1).attr("stroke-width","3px")}var W=0,A=0,b=[],E=N[l],b=t.filter(function(e){return E.indexOf(e.groupByValue)>=0});B.filter(function(e,r){var o={};o[l]=e[l];var a=0;d.forEach(function(r){var o=I.proportion.filter(function(e){return e.name==r})[0].perc/100;a+=e[r]*o}),o.predictedYSmooth=a,o.groupByValue="Total",b.push(o)});var X=h(t,l,N[l]);V.html("<ul style='list-style-type:disc' > <li>Across all categories, the impact of <b>"+l+" </b> on <b>"+O+"</b> is lowest from <b> ["+X.lowestRange+"] </b> "+X.lowestGroup+" and highest from <b> ["+X.highestRange+"] </b> "+X.highestGroup+"</li> <li> The impact of <b>"+l+" </b>  on <b>"+O+"</b> from <b> ["+X.highestRange+"]  </b>"+X.highestGroup+" is  "+P.formatLabel(X.diffMaxOverall)+" higher than the overall median imapct and "+P.formatLabel(X.diffMaxMin)+" higher than the average impact from <b> ["+X.lowestRange+"] </b>"+X.lowestGroup+"</li> </ul>");var _=[];for(var Z in R){var K=0,$=0;for(var ee in N[l]){var re=N[l][ee],oe=N[l].length==d.length?s(C,R[Z],re,l):m(C,R[Z],re,l),ae=I.proportion.filter(function(e){return e.name==re})[0].perc/100;K+=oe*ae,$+=ae}_.push({percentile:R[Z],value:P.formatLabel(K/$)})}b=b.sort(function(e,r){return e[l]-r[l]}),M.domain(d3.extent(b,function(e){return e[l]})),b.forEach(function(e){W=d3.min([W,e.predictedYSmooth]),A=d3.max([A,e.predictedYSmooth])}),x.domain([W,A]);var te=d3.axisBottom().scale(M);if(G.transition().duration(1e3).call(J),w&0!=N[l].length){var le=z.selectAll("line").data(_).style("opacity",1);le.exit().remove(),le.enter().append("line").style("opacity",1).attr("x1",function(e){return M(e.value)}).attr("y1",30*Y+40).attr("x2",function(e){return M(e.value)}).attr("y2",n+30*Y+20).attr("stroke","#75787B").attr("stroke-width","2px"),le.transition().attr("x1",function(e){return M(e.value)}).attr("y1",30*Y+40).attr("x2",function(e){return M(e.value)}).attr("y2",n+30*Y+20).attr("stroke","#75787B").attr("stroke-width","2px");var ie=U.selectAll("text").data(_).style("opacity",1);ie.exit().remove(),ie.enter().append("text").text(function(e){return e.percentile}).attr("transform",function(e){return"translate("+(M(e.value)-5)+",65)"}),ie.transition().text(function(e){return e.percentile}).attr("transform",function(e){return"translate("+(M(e.value)-5)+",65)"})}0==N[l].length&&(z.selectAll("line").style("opacity",0),U.selectAll("text").style("opacity",0)),G.selectAll("line").attr("opacity",.05).style("stroke-dasharray","5, 5"),j.call(te),H.selectAll(".path").remove();var ne=H.selectAll(".path").data(E);ne.exit().transition().duration(500).remove(),ne.enter().append("path").attr("fill","none").attr("class",function(r){return"path layer"+r+" path"+r+e+" layer"+e}).attr("stroke",function(e){return D[l][e]}).attr("stroke-width","2px").datum(function(e){var r=[];return b.map(function(o){o.groupByValue==e&&r.push(o)}),r}).style("cursor","pointer").attr("d",L).on("mouseenter",f).on("mousemove",v).on("mouseout",k);p.selectAll("button").data(c.sort(P.sortAlphaNum)).enter().append("button").attr("class","legend-btn").style("background-color",function(e){return D[l][e]}).style("cursor","pointer").on("click",y).on("mouseover",u).on("mouseout",g).html(function(e){return e});F.on("mouseenter",f).on("mousemove",v).on("mouseout",k)}function o(){var e=M.invert(d3.event.pageX-.02*P.getWidth()),r=C.map(function(e){return e[l]}),o=u(e,r);return o}function u(e,r){for(var o=r[0],a=Math.abs(e-o),t=0;t<r.length;t++){var l=Math.abs(e-r[t]);l<a&&(a=l,o=r[t])}return o}var c=[],d=[];t.forEach(function(e){c.indexOf(e.groupByValue)<0&&c.push(e.groupByValue)}),v.AppData[e].Data.forEach(function(e){d.indexOf(e.groupByValue)<0&e.groupByVarName==E&&d.push(e.groupByValue)});var B=[],k=d3.nest().key(function(e){return e[l]}).entries(v.AppData[e].Data);k.forEach(function(r){var o={};o[l]="Continuous"==v.AppData[e].Type?parseFloat(r.key):r.key,d.forEach(function(e){var a=r.values.filter(function(r){return r.groupByValue==e});1==a.length?o[e]=a[0].predictedYSmooth:o[e]=null}),B.push(o)}),b=P.createChart(y,i),P.setTitle(g,"Impact of "+(S>=0?"increasing":"decreasing")+" "+l+" by "+S+(v.AppData[e].Change.indexOf("Default")>=0?" (1 standard deviation) ":"")+" on "+O),b.selectAll("*").remove(),b.attr("width",i),c=c.sort(P.sortAlphaNum);var f=140,W=parseInt(i/f),Y=Math.ceil(c.length/W),F=b.append("rect").attr("class","overlay").attr("width",i-a.left).attr("height",n).attr("x",a.left).attr("y",a.top+30*Y).style("fill","none").style("cursor","pointer").style("pointer-events","all"),A=b.append("g").attr("transform","translate(100,"+(n+30*Y+55)+")");A.append("line").attr("x1",0).attr("y1",0).attr("x2",20).attr("y2",0).attr("stroke","#75787B").attr("stroke-width","3px"),A.append("text").text("Percentile").attr("x",30).attr("y",5);b.attr("height",300+30*Y);var M=d3.scaleLinear().range([a.left,i]),x=d3.scaleLinear().range([n-30,0]),L=d3.line().x(function(e){return M(e[l])}).y(function(e){return x(e.predictedYSmooth)}).curve(d3.curveBasis),z=b.append("g").attr("class","percRefLines").attr("transform","translate(10,0)"),U=b.append("g").attr("class","textRefLines").attr("transform","translate(10,0)"),j=b.append("g").attr("class","xAxis").attr("transform","translate(10,"+(n+30*Y+20)+")"),G=b.append("g").attr("class","yAxis").attr("transform","translate(60,70)"),H=b.append("g").attr("class","lineG").attr("transform","translate(10,"+(30*Y+40)+")"),Q=(b.append("g").attr("class","lineGT").attr("transform","translate(10,"+(30*Y+40)+")"),b.append("text").attr("class","label").attr("transform","translate("+i/2+","+(n+30*Y+60)+")").style("text-anchor","middle").text(l),b.append("text").attr("class","label").attr("transform","translate(15,"+(n-50)+")rotate(-90)").style("text-anchor","middle").text("Impact on "+O),b.append("line").style("opacity",0).attr("x1",0).attr("y1",30*Y+30).attr("x2",0).attr("y2",n+30*Y+20).attr("stroke","#75787B"));x.domain([-1,1]);var J=d3.axisLeft().scale(x).tickSizeInner(-i+a.left-10);G.call(J),r(!1)}function o(){function r(e){var r=[];return e.forEach(function(e){r.indexOf(e[l])<0&&r.push(e[l])}),r}function o(){function r(r,o){q.attr("class","colorClass"+e+o),q.transition().duration(200).delay(100).style("opacity",1),q.html("Within the <span>"+r.key+" </span> group, the model believes that changing <span>"+l+"</span> from <span> "+r.parent+" </span> to <span>"+S+"</span> leads to, on average, a <span>"+Math.abs(P.formatLabel(r.value))+(P.formatLabel(r.value)>=0?" increase":" decrease")+"</span> in "+O).style("left",function(){var e=this.getBoundingClientRect().width,r=d3.event.pageX;return i>e+r+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),q.style("color",D[l][r]),d3.selectAll(".layer"+e).style("opacity","0.4"),d3.select(this).style("opacity",1).style("stroke","black").attr("stroke-width","1px")}function a(r,o){q.attr("class","colorClass"+e+o),q.transition().duration(200).delay(100).style("opacity",1),q.html("Within the <span>"+r.key+" </span> group, the model believes that changing <span>"+l+"</span> from <span> "+r.parent+" </span> to <span>"+S+"</span> leads to, on average, a <span>"+Math.abs(P.formatLabel(r.value))+(P.formatLabel(r.value)>=0?" increase":" decrease")+"</span> in "+O).style("left",function(){var e=this.getBoundingClientRect().width,r=d3.event.pageX;return i>e+r+25?d3.event.pageX+5+"px":d3.event.pageX-e-5<10?"10px":d3.event.pageX-e-5+"px"}).style("top",d3.event.pageY-28+"px"),q.style("color",D[l][r.key]),d3.selectAll(".layer"+e).style("opacity","0.4"),d3.select(this).style("opacity",1).style("stroke","black").attr("stroke-width","1px")}function n(e,r){q.transition().style("opacity",0),T=!1,F.transition().style("opacity",0),d3.select(this).attr("stroke-width","0px")}function g(e,r){d3.selectAll(".rect"+e.replace(/[^a-zA-Z]/g,"")).style("stroke","black").attr("stroke-width","1px")}function y(e,r){d3.selectAll(".rect"+e.replace(/[^a-zA-Z]/g,"")).style("stroke","black").attr("stroke-width","0px")}function s(e,r){N[l].indexOf(e)>=0?(N[l].splice(N[l].indexOf(e),1),o(!1),d3.select(this).style("opacity",.5).style("background-color","#A7A8AA")):(N[l].push(e),o(!1),d3.select(this).style("opacity",1).style("background-color",D[l][e]))}function h(e,r){e.each(function(){for(var e,o=d3.select(this),a=(o.text()+" → "+S).split(/\s+/).reverse(),t=[],i=0,n=1.1,c=o.attr("y"),g=parseFloat(o.attr("dy")),p=o.text(null).append("tspan").attr("x",0).attr("y",c).attr("dy",g+"em");e=a.pop();)t.push(e),p.text(t.join(" ")),p.node().getComputedTextLength()>r&&(t.pop(),p.text(t.join(" ")),t=[e],p=o.append("tspan").attr("x",0).attr("y",c).attr("dy",++i*n+g+"em").text(e));u=d3.max([450+20*i,u]),d3.select("#topchlvl-"+l.replace(/[^a-zA-Z]/g,"")).style("height",u+10+"px"),d3.select("#chlvl-"+l.replace(/[^a-zA-Z]/g,"")).style("height",u+"px")})}b=d3.select("#chlvl-"+l.replace(/[^a-zA-Z]/g,"")).select("svg");var B=m.filter(function(e){return N[l].indexOf(e)>=0}),M=0,x=0;C.forEach(function(e){var r=d3.min(B,function(r){return e[r]}),o=d3.max(B,function(r){return e[r]});r<M&&(M=r),o>x&&(x=o)}),M=M>0?.9*M:1.1*M,x=x>0?1.1*x:.9*x;var L=[M>0?0:M,x<0?0-.1*M:x];f.domain(L),v.domain(c),k.domain(B).rangeRound([0,v.bandwidth()]);var w=d(t,l,N[l],c);V.html("<ul style='list-style-type:disc' > <li>Across all categories, the impact of <b>"+l+" </b> on <b>"+O+"</b> is lowest for <b> "+w.lowestQuartile+" </b>  "+w.lowestGroup+" and highest for <b> "+w.highestQuartile+" </b> "+w.highestGroup+"</li> <li> The impact of <b>"+l+" </b>  on <b>"+O+"</b> for <b>"+w.highestQuartile+" </b> "+w.highestGroup+" is  "+P.formatLabel(w.diffMaxOverall)+" higher than the overall median impact and "+P.formatLabel(w.diffMaxMin)+" higher than the average impact from <b>"+w.lowestQuartile+"</b> "+w.lowestGroup+"</li>  </ul>");var R=d3.axisBottom().scale(v);W.transition().duration(1e3).call(A),Y.selectAll("g").remove(),Y.selectAll("g").data(c).enter().append("g").attr("transform",function(e){return"translate("+v(e)+",0)"}).selectAll("rect").data(function(e){return B.map(function(r){if(N[l].indexOf(r)>=0){var o={};return o.parent=e,o.key=r,o.value=C.filter(function(r){return r[l]==e})[0][r],o}})}).enter().append("rect").attr("class",function(e){return"rect"+e.key.replace(/[^a-zA-Z]/g,"")}).attr("x",function(e){return k(e.key)}).attr("y",function(e){return f(f(e.value)>=f(0)?0:e.value)}).attr("width",k.bandwidth()).attr("height",function(e){return f(e.value)-f(0)>=0?f(e.value)-f(0):f(0)-f(e.value)}).attr("fill",function(e,r){return D[l][e.key]}).on("mouseover",r).on("mousemove",a).on("mouseout",n).style("cursor","pointer").style("stroke","#000").style("stroke-width","1px"),W.selectAll("line").attr("opacity",.15).style("stroke-dasharray","4, 4"),b.select(".xAxis").call(R).attr("transform","translate(0,"+(f(0)+70)+")"),b.select(".xAxis").selectAll("text").attr("x",function(e){return 0}).attr("transform","translate(0,"+(f(L[0])-f(0))+")").call(h,.9*v.bandwidth());p.selectAll("button").data(m).enter().append("button").attr("class","legend-btn").style("background-color",function(e){return D[l][e]}).on("click",s).on("mouseover",g).on("mouseout",y).style("cursor","pointer").html(function(e){return e})}var u=0,c=r(C);b=P.createChart(y,i);var m=[];t.forEach(function(e){m.indexOf(e.groupByValue)<0&&m.push(e.groupByValue)}),P.setTitle(g,"Sensitivity Plot: Impact of Changing "+l),m=m.sort(P.sortAlphaNum),b.selectAll("*").remove(),i/(c.length*m.length)<=20&&(i=c.length*m.length*20),b.attr("width",i);var s=140,h=parseInt(i/s),B=Math.ceil(m.length/h);b.attr("height",300+30*B);var v=d3.scaleBand().range([a.left,i]).paddingInner(.25),k=d3.scaleBand().padding(.25),f=d3.scaleLinear().range([n,0]);b.append("g").attr("class","xAxis").attr("transform","translate(10,"+(n+30*B+20)+")");var W=b.append("g").attr("class","yAxis").attr("transform","translate(60,70)"),Y=b.append("g").attr("transform","translate(0,70)"),F=(b.append("text").attr("class","label").attr("transform","translate("+i/2+","+30*B+")").style("text-anchor","middle").text(l),b.append("text").attr("class","label").attr("transform","translate(15,"+(n-50)+")rotate(-90)").style("text-anchor","middle").text("Impact on "+O),b.append("line").style("opacity",0).attr("x1",0).attr("y1",30*B).attr("x2",0).attr("y2",n+30*B+10).attr("stroke","#75787B"));f.domain([-1,1]);var A=d3.axisLeft().scale(f).tickSizeInner(-i+a.left);W.call(A),o()}var a={top:30,right:15,bottom:60,left:60},t=v.AppData[e].Data.filter(function(e){return e.groupByVarName==E&&z.indexOf(e.groupByValue)<0});if(0==t.length)return null;var l=Object.keys(v.AppData[e].Data[0]).filter(function(e){return L.indexOf(e)<0})[0],i=.74*P.getWidth()-a.left-a.right,n=300-a.top-a.bottom,u=F.append("div").attr("class","chart-lev").attr("id","topchlvl-"+l.replace(/[^a-zA-Z]/g,"")),c=u.append("div").attr("class","app").attr("id","chlvl-"+l.replace(/[^a-zA-Z]/g,"")).style("height","450px"),g=c.append("div").attr("class","Title"),p=c.append("div").attr("class","legend").attr("width",i-100).attr("height",n-100),y=(c.append("div").attr("class","Filtercontainer"),c.append("div").attr("class","Total"),c.append("div").attr("class","Chartcont")),B=u.append("div").attr("class","desc").style("height","560px"),V=B.append("div").attr("class","desc-text").html("Few Insights will come here"),S=(c.append("div").attr("class","Source"),c.append("div").attr("class","Attribution"),""),N={};N[l]=[],t.forEach(function(e){N[l].indexOf(e.groupByValue)<0&&N[l].push(e.groupByValue)});var C=[],k=d3.nest().key(function(e){return e[l]}).entries(t);k.forEach(function(r){var o={};o[l]="Continuous"==v.AppData[e].Type?parseFloat(r.key):r.key,N[l].forEach(function(e){var a=r.values.filter(function(r){return r.groupByValue==e});1==a.length?o[e]=a[0].predictedYSmooth:o[e]=null}),C.push(o)});C[0];"Continuous"==v.AppData[e].Type?(S=P.formatLabel(v.AppData[e].Change.indexOf("Default")>=0?v.AppData[e].Change.split(":")[1]:v.AppData[e].Change),r()):"Categorical"==v.AppData[e].Type&&(S=v.AppData[e].Change.indexOf("Default")>=0?v.AppData[e].Change.split(":")[1]:v.AppData[e].Change,o())}var N=o(2),C=a(N),v=o(1);o(6);var P=new C.default,k=d3.select("#App"),f=(k.append("div").attr("class","heading").append("a").attr("href","https://github.com/DataScienceSquad/WhiteBox_Production").html("White Box - Impact By Variable"),k.append("div").attr("class","subheading").append("a").attr("href","https://github.com/DataScienceSquad/WhiteBox_Production/wiki/How-to-interpret-WhiteBox-charts").html("How to interpret WhiteBox Charts"),k.append("div").attr("class","summary")),W=f.append("div").attr("class","heatMapContainer"),Y=f.append("div").attr("class","filt-cont"),F=k.append("div").attr("class","Chartcontainer"),q=d3.select("body").append("div").attr("id","tooltip").style("opacity",0);d3.select("body").on("click",function(){T&&(q.style("opacity",0),T=!1)});var A,b,M,x=["#86BC25","#00A3E0","#00ABAB","#C4D600","#2C5234","#9DD4CF","#004F59","#62B5E5","#43B02A","#0076A8","#9DD4CF","#012169"],L=["predictedYSmooth","groupByVarName","groupByValue","highlight","errNeg","errPos"],w=!0,O="Quality",T=!1,R=[10,50,90],D={},E="",z=[],I={};M=P.createChart(W,A),window.togglePercentile=l,window.intializeTreeMap=g,V(),y(),i(),g(v.AppData[0].Data[0].groupByVarName),window.onresize=function(){d3.select(".Chartcontainer").selectAll("*").remove(),A=P.getWidth(),g(v.AppData[0].Data[0].groupByVarName)}},function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=<***>;r.AppData=o},function(e,r){"use strict";function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,o,a){return o&&e(r.prototype,o),a&&e(r,a),r}}(),t=function(){function e(){o(this,e)}return a(e,[{key:"setTitle",value:function(e,r){e.selectAll("*").remove();e.append("span").html(r)}},{key:"setLabel",value:function(e,r){e.selectAll("*").remove();e.append("span").html(r)}},{key:"setSource",value:function(e,r){e.selectAll("*").remove(),e.html(r)}},{key:"formatLabel",value:function(e){return e=d3.format(".3f")(e),e=e.replace(/\.0$/,"")}},{key:"createChart",value:function(e,r){var o=e.append("svg");return o.attr("width",r),o}},{key:"getWidth",value:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},{key:"sortDictionary",value:function(e,r){var o=e.name.toLowerCase(),a=r.name.toLowerCase();return o<a?-1:o>a?1:0}},{key:"sortAlphaNum",value:function(e,r){var o=/[^a-zA-Z]/g,a=/[^0-9]/g,t=e.replace(o,""),l=r.replace(o,"");if(t===l){var i=parseInt(e.replace(a,""),10),n=parseInt(r.replace(a,""),10);return i===n?0:i>n?1:-1}return t>l?1:-1}},{key:"shortenString",value:function(e){return e.length>=20?e.slice(0,20)+"...":e}}]),e}();r.default=t},function(e,r,o){r=e.exports=o(4)(),r.push([e.id,'/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*,:after,:before{box-sizing:border-box;-webkit-tap-highlight-color:transparent}svg{overflow:visible!important}body,html{background-color:#fff;font-family:Open Sans,sans-serif}#App{overflow:hidden;width:100%}.heading{height:50px;font-size:24px;padding-top:15px}.heading,.subheading{position:fixed;margin-left:1%;width:98%;text-align:center;color:#00a3e0;font-weight:800;box-shadow:2px 2px 4px rgba(0,0,0,.247059);z-index:999;background-color:#fff}.subheading{top:50px;height:20px;font-size:12px}.filt-cont{width:24%;height:50px;float:left}.dropdown{width:100%;color:#53565a;position:relative;display:inline-block;margin-left:1%;margin-top:10px}.dropdown-content{display:none;position:absolute;background-color:#fff;z-index:1;width:100%;border:1px solid #00a3e0;border-radius:2px;border-top:none;overflow:auto;max-height:300px}.dropdown-content a{color:#53565a;padding:3px 5px;text-decoration:none;display:block;cursor:pointer}.dropdown-content a:hover{background-color:#00a3e0}.dropdown:hover .dropdown-content{display:block}.dropbtn{color:#53565a;background-color:#fff;font-size:14px;border:none;text-align:left;padding-top:3px;padding-bottom:3px;cursor:pointer;width:100%;height:30px;border:1px solid #00a3e0}.drpbtn:focus{outline:none}.heatMapContainer{height:120px;width:74%;margin-left:1%;padding-top:5px;margin-top:10px;float:left}#tooltip{position:absolute;width:auto;text-align:center;border-radius:5px;pointer-events:none;background-color:#fff;padding:8px;z-index:100;font-size:14px;max-width:300px;border:1px solid rgba(0,0,0,.1);box-shadow:4px 4px 6px rgba(0,0,0,.2);z-index:1000}#tooltip span{font-weight:700;font-size:17px}.Title{color:#000;font-size:16px;font-weight:600;padding:12px;text-align:center;text-decoration:underline;width:99%;float:left}.Source{font-weight:300;font-size:14px;padding-left:12px;padding-right:12px;text-align:left}.Source p{margin:2px}svg text{font-size:14px;fill:#53565a;font-weight:400}.app{width:74%;float:left;overflow:auto}.Chartcontainer{margin-top:150px;width:100%;float:left}.summary{padding-top:5px;margin-top:2px;height:130px;box-shadow:2px 2px 4px rgba(0,0,0,.247059);position:fixed;width:98%;top:68px;background-color:#fff;margin-left:1%;z-index:1000}.Chartcontainer button{max-width:200px;height:30px;border:none;margin-left:20px;margin-bottom:3px;font-family:Open Sans,sans-serif;font-size:16px;font-weight:600;color:#fff}.Chartcontainer button:focus{outline:0}.tick{font-weight:700}.tick line{opacity:.15}.Chartcontainer button:hover{background-color:#fff;color:#000}.legend{width:90%;margin-left:5%;display:inline-flex;justify-content:center;flex-wrap:wrap;float:left}.legend-btn{width:200px;border:2px solid #53565a!important;border-radius:2px}.label{font-size:12px;font-weight:700}.chart-lev{margin-top:50px;width:98%;box-shadow:2px 2px 4px rgba(0,0,0,.247059);margin-left:1%;display:inline-block}.desc{width:24%;float:left;margin-left:1%}.desc-text{height:320px;width:98%;margin-top:40px;padding:5px;font-size:14px;text-align:justify;overflow-y:auto}.desc-text ul{padding-left:10px}.rect{border:2px solid #53565a}.heading a,.heading a:focus,.subheading a,.subheading a:focus{color:#00a3e0}.perc-check{height:50px;width:98%;margin-left:1%;display:block;position:relative;padding-left:5px;margin-top:12px;cursor:pointer;font-size:16px;color:#53565a;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.perc-check input{cursor:pointer}.perc-checkinput,.perc-check input{position:absolute;opacity:0}.perc-checkinput+label{position:relative;cursor:pointer;padding:0;width:20px;height:20px}.perc-checkinput+label:before{content:"";margin-right:10px;display:inline-block;vertical-align:text-top;width:20px;height:20px;background:#00a3e0;color:#86bc25;border:1px solid #fff;border-radius:2px}.perc-checkinput:hover+label:before{background:#00a3e0;color:#00a3e0}.perc-checkinput:checked+label:before{color:#00a3e0;background:#00a3e0;border:1px solid #fff;border-radius:2px}.perc-checkinput:disabled+label{color:#63666a;cursor:auto}.perc-checkinput:disabled+label:before{box-shadow:none;background:#00a3e0}.perc-checkinput:checked+label:after{content:"";position:absolute;left:4px;top:8px;background:#fff;width:3px;height:3px;box-shadow:2px 0 0 #fff,4px 0 0 #fff,4px -2px 0 #fff,4px -4px 0 #fff,4px -6px 0 #fff,4px -8px 0 #fff;transform:rotate(45deg)}',""])},function(e,r){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],r=0;r<this.length;r++){var o=this[r];o[2]?e.push("@media "+o[2]+"{"+o[1]+"}"):e.push(o[1])}return e.join("")},e.i=function(r,o){"string"==typeof r&&(r=[[null,r,""]]);for(var a={},t=0;t<this.length;t++){var l=this[t][0];"number"==typeof l&&(a[l]=!0)}for(t=0;t<r.length;t++){var i=r[t];"number"==typeof i[0]&&a[i[0]]||(o&&!i[2]?i[2]=o:o&&(i[2]="("+i[2]+") and ("+o+")"),e.push(i))}},e}},function(e,r,o){function a(e,r){for(var o=0;o<e.length;o++){var a=e[o],t=m[a.id];if(t){t.refs++;for(var l=0;l<t.parts.length;l++)t.parts[l](a.parts[l]);for(;l<a.parts.length;l++)t.parts.push(c(a.parts[l],r))}else{for(var i=[],l=0;l<a.parts.length;l++)i.push(c(a.parts[l],r));m[a.id]={id:a.id,refs:1,parts:i}}}}function t(e){for(var r=[],o={},a=0;a<e.length;a++){var t=e[a],l=t[0],i=t[1],n=t[2],u=t[3],c={css:i,media:n,sourceMap:u};o[l]?o[l].parts.push(c):r.push(o[l]={id:l,parts:[c]})}return r}function l(e,r){var o=d(),a=S[S.length-1];if("top"===e.insertAt)a?a.nextSibling?o.insertBefore(r,a.nextSibling):o.appendChild(r):o.insertBefore(r,o.firstChild),S.push(r);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");o.appendChild(r)}}function i(e){e.parentNode.removeChild(e);var r=S.indexOf(e);r>=0&&S.splice(r,1)}function n(e){var r=document.createElement("style");return r.type="text/css",l(e,r),r}function u(e){var r=document.createElement("link");return r.rel="stylesheet",l(e,r),r}function c(e,r){var o,a,t;if(r.singleton){var l=V++;o=B||(B=n(r)),a=g.bind(null,o,l,!1),t=g.bind(null,o,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=u(r),a=y.bind(null,o),t=function(){i(o),o.href&&URL.revokeObjectURL(o.href)}):(o=n(r),a=p.bind(null,o),t=function(){i(o)});return a(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;a(e=r)}else t()}}function g(e,r,o,a){var t=o?"":a.css;if(e.styleSheet)e.styleSheet.cssText=N(r,t);else{var l=document.createTextNode(t),i=e.childNodes;i[r]&&e.removeChild(i[r]),i.length?e.insertBefore(l,i[r]):e.appendChild(l)}}function p(e,r){var o=r.css,a=r.media;if(a&&e.setAttribute("media",a),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}function y(e,r){var o=r.css,a=r.sourceMap;a&&(o+="\\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var t=new Blob([o],{type:"text/css"}),l=e.href;e.href=URL.createObjectURL(t),l&&URL.revokeObjectURL(l)}var m={},s=function(e){var r;return function(){return"undefined"==typeof r&&(r=e.apply(this,arguments)),r}},h=s(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),d=s(function(){return document.head||document.getElementsByTagName("head")[0]}),B=null,V=0,S=[];e.exports=function(e,r){r=r||{},"undefined"==typeof r.singleton&&(r.singleton=h()),"undefined"==typeof r.insertAt&&(r.insertAt="bottom");var o=t(e);return a(o,r),function(e){for(var l=[],i=0;i<o.length;i++){var n=o[i],u=m[n.id];u.refs--,l.push(u)}if(e){var c=t(e);a(c,r)}for(var i=0;i<l.length;i++){var u=l[i];if(0===u.refs){for(var g=0;g<u.parts.length;g++)u.parts[g]();delete m[u.id]}}}};var N=function(){var e=[];return function(r,o){return e[r]=o,e.filter(Boolean).join("\\n")}}()},function(e,r,o){var a=o(3);"string"==typeof a&&(a=[[e.id,a,""]]);o(5)(a,{});a.locals&&(e.exports=a.locals)}]);
